digraph G {
graph [fontname = "IBM Plex Sans"];
node [fontname = "IBM Plex Sans"];
edge [fontname = "IBM Plex Sans"];
BEGIN [label="Begin",shape=diamond];
WAIT_VIN_ON [label="Wait for\nVin"];
ENT_CHARGING [label="Enter\ncharging",shape=box];
CHARGING [label="Charging"];
ENT_ON [label="Enter\non",shape=box];
ON [label="On"];
ENT_DEPLETING [label="Enter\ndepleting",shape=box];
DEPLETING [label="Depleting"];
ENT_SHUTDOWN [label="Enter\nshutdown",shape=box];
SHUTDOWN [label="Shutdown"];
ENT_WATCHDOG_REBOOT [label="Enter\nwatchdog\nreboot",shape=box];
WATCHDOG_REBOOT [label="Watchdog\nreboot"];
ENT_OFF [label="Enter off",shape=box];
OFF [label="Off",shape=diamond];

ENT_SLEEP_SHUTDOWN [label="Enter\nsleep\nshutdown",shape=box];
SLEEP_SHUTDOWN [label="Sleep\nshutdown"];
ENT_SLEEP [label="Enter\nsleep",shape=box];
SLEEP [label="Sleep"];

BEGIN -> WAIT_VIN_ON [color="red",weight=8];
WAIT_VIN_ON -> WAIT_VIN_ON;
WAIT_VIN_ON -> ENT_CHARGING [label="Vin>9V"];
ENT_CHARGING -> CHARGING [color="red",weight=8];
CHARGING -> CHARGING;
CHARGING -> ENT_ON [label="Vcap>6V"];
CHARGING -> ENT_OFF [label="Vin<9V"];
ENT_ON -> ON [color="red",label="EN5V=true",weight=8];
ON -> ON;
ON -> ENT_WATCHDOG_REBOOT [label="WD not\nreset\nin 10s"];
ON -> ENT_DEPLETING [label="Vin<9V"];
ON -> ENT_OFF [label="poweroff>1s"];
ON -> ENT_SLEEP_SHUTDOWN [label="sleep\nrequested"];
ON -> ENT_SHUTDOWN [label="shutdown\nrequested"];
ENT_DEPLETING -> DEPLETING [color="red",weight=8];
DEPLETING -> DEPLETING;
DEPLETING -> ENT_WATCHDOG_REBOOT [label="WD not\nreset\nin 10s"];
DEPLETING -> ENT_SHUTDOWN [label="shutdown\nrequested"];
DEPLETING -> ENT_ON [label="Vin>9V"];
DEPLETING -> ENT_OFF [label="Vcap<5V\npoweroff>1s"];
ENT_SHUTDOWN -> SHUTDOWN [color="red",weight=8];
SHUTDOWN -> ENT_OFF [label="60s\npoweroff>1s"];
ENT_OFF -> OFF [color="red",label="EN5V=false",weight=8];
OFF -> BEGIN [label="5s"];
ENT_WATCHDOG_REBOOT -> WATCHDOG_REBOOT [color="red",label="EN5V=false",weight=8];
WATCHDOG_REBOOT -> BEGIN [label="2s"];
ENT_SLEEP_SHUTDOWN -> SLEEP_SHUTDOWN [color="red",weight=8];
SLEEP_SHUTDOWN -> ENT_SLEEP [label="60s\npoweroff>1s"];
ENT_SLEEP -> SLEEP [color="red",label="EN5V=false",weight=8];
SLEEP -> BEGIN [label="RTC wakeup\nEXT wakeup"];
}
